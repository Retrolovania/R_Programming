---
title: 'Week 9: Lab - Using aRules on the Titanic dataset '
author: 'Adam Saoud'
date: '3-10-2024'
output: html_document
---

---

# Instructions
Use the Titanic dataset to explore descriptive statistics, functions, and
association rules. Download the titanic dataset `titanic.raw.rdata` from one
of two locations:

- https://github.com/ethen8181/machine-learning/tree/master/association_rule/R
- https://sites.google.com/a/rdatamining.com/www/data/titanic.raw.rdata?attredirects=1
 
Note that it is not a cvs file, but rather an RData workspace. So, to load the 
data (assuming you saved it to the project's data folder), one would do:

``load("data/titanic.raw.rdata")``

You need to look at titanic.raw (the name of the R dataset)

``t <- titanic.raw``

Now that you have the datafile, do some descriptive statistics, getting some 
extra practice using R. Take the Quiz for Step 1 and 2. However your submission 
**MUST** include the process of you calculating the following values in Step 1 and 2.

---

```{r setup, message = FALSE}
library(arules)
library(arulesViz)
```

# Step 0 - Load the data
Using the instructions above, load the dataset and save it as `t`.

```{r, "Step 0"}
load("titanic.raw.rdata")
tdata <- titanic.raw

```
---


# Step 1 - Descriptive stats 
Important: Right next to your code, your answer should be written such as # 14% of children survived after rounding the 1 decimal place. For example, 1.36 is 2 
1. Compute the percentage of people that survived.
2. Compute the percentage of people that were children.
3. Compute the percentage of people that were female.
4. Finally, compute the percentage of people that were in first class.

```{r, "Step 1"}
# 1. Percentage of survivors.
survived_count <- sum(tdata$Survived == "Yes")
total_count <- nrow(tdata)
s_percent <- round((survived_count / total_count) * 100)
cat(s_percent,"%", "of people survived.")
# About 32% of people survived.

#2. Percentage of people that were children.
child_count <- sum(tdata$Age == "Child")
kid_percent <- round((child_count / total_count) * 100)
cat(kid_percent,"%", "of people on Titanic were children.")
# About 5% of people were children.

#3. Percentage of people that were female.
fem_count <- sum(tdata$Sex == "Female")
fem_percent <- round((fem_count / total_count) * 100)
cat(fem_percent,"%", "of people on Titanic were female.")
# About 21% of people were female.

#4. Percentage of people in first class.
fclass_count <- sum(tdata$Class == "1st")
fclass_percent <- round((fclass_count / total_count) * 100)
cat(fclass_percent,"%", "of people on Titanic were in First Class.")
# About 15% of people were in first class.
```

---

# Step 2 - More descriptive stats 


1. What percentage of children survived? Your answer should be written such as # 14% of children survived after rounding the 1 decimal place. For example, 1.36 is 2
2. What percentage of female survived?
3. What percentage of first-class people survived?
4. What percentage of third-class people survived?

```{r, "Step 2"}
# 1. Percent of children that survived.
children_survived <- subset(tdata, Age == "Child" & Survived == "Yes")
cs_count <- nrow(children_survived)
cs_percent <- round((cs_count / total_count) * 100)
cat(cs_percent,"%", "of the children aboard Titanic survived.")
# About 3% of the children aboard Titanic survived.

#2. Percent of females that survived.
fem_survived <- subset(tdata, Sex == "Female" & Survived == "Yes")
fs_count <- nrow(fem_survived)
fs_percent <- round((fs_count / total_count) * 100)
cat(fs_percent,"%", "of the females aboard Titanic survived.")
# About 16% of the Titanic survivors were female.

#3. Percent of First Class passengers that survived.
first_survived <- subset(tdata, Class == "1st" & Survived == "Yes")
first_count <- nrow(first_survived)
first_percent <- round((first_count / total_count) * 100)
cat(first_percent,"%", "of first class passengers aboard Titanic survived.")
# About 9% of the Titanic survivors were first class.

#4. Percent of Third Class passengers that survived.
third_survived <- subset(tdata, Class == "3rd" & Survived == "Yes")
third_count <- nrow(third_survived)
third_percent <- round((third_count / total_count) * 100)
cat(third_percent,"%", "of third class passengers aboard Titanic survived.")
# About 8% of the Titanic survivors were third class.


```

---

# Step 3 - Writing a function 

## Step 3.1 - Function 1
Write a function that returns a new dataframe of people that satisfies the 
specified criteria of sex, age, class and survived as parameters. I'm giving you 
the answer for this question:

```
myfunction1 <- function(a,b,c,d){
df1 <- t[t$Class == a,] # filter the data that satisfied the criteria that "Class" = a
df2 <- df1[df1$Sex == b,] # filter the data that satisfied the criteria that "Sex" = b
df3 <- df2[df2$Age == c,] # filter the data that satisfied the criteria that "Age" = c
df4 <- df3[df3$Survived == d,] # filter the data that satisfied the criteria that "Survived" = d
return(df4)}
# test the function with a sample data
myfunction1("1st","Female","Adult","No")
```

```{r, "Step 3.1"}
create_DF <- function(a,b,c,d){
df1 <- tdata[tdata$Class == a,]
df2 <- df1[df1$Sex == b,]
df3 <- df2[df2$Age == c,]
df4 <- df3[df3$Survived == d,]
return(df4)}
#Test with the values below:
create_DF("2nd", "Male", "Child", "Yes")
```

## Step 3.2 - Function 2
Write a function, using the previous function, that calculates the percentage (who lives, who dies) for specified (parameters) classes. The function passes four arguments. Calculating percentage means that the number of observations that meets the criteria (values of the specified classes) divided by the entire number of observations.  


```{r, "Step 3.2"}
percent_calc <- function(class,sex,age,survive){
  filter_df <- create_DF(class,sex,age,survive)
  filter_count <- nrow(filter_df)
  percentage <- round((filter_count / total_count) * 100)
  return(percentage)
}

```

```{r}
example_survive <- percent_calc("1st", "Female", "Adult", "Yes")
example_survive
example_death <- percent_calc("3rd", "Male", "Adult", "Yes")
example_death
```

## Step 3.3 - Use the function (male)
Use the function to compare age and third-class male survival rates. 

```{r, "Step 3.3"}
third_child_survive <- percent_calc("3rd", "Male", "Child", "Yes")
third_child_survive
third_adult_survive <- percent_calc("3rd", "Male", "Adult", "Yes")
third_adult_survive

```
People in which category are more likely to survive? 

> More male adults in 3rd class survived the Titanic disaster than male children in 3rd class.


## Step 3.4 - Use the function (female)
Use the function to compare age and first-class female survival rates.

```{r, "Step 3.4"}
first_child_survive <- percent_calc("1st", "Female", "Child", "Yes")
first_child_survive
first_adult_survive <- percent_calc("1st", "Female", "Adult", "Yes")
first_adult_survive

```
People in which category are more likely to survive? 

> All first class, adult, female passangers on Titanic survived. No children were spared.

---

# Step 4 - Use aRules 

1. Use aRules to calculate some rules (clusters) for the titanic dataset. set support threshold as 0.005, and confidence as 0.5. Show only rhs=(“Survived=Yes”). Read the documentation to investigate “appearance”
2. Visualize the results.
3. Pick the three most interesting and useful rules (a. pick rules whose lift is higher than 2, b. sort the good rules by “lift”). Explain these rules using natural language.  **Answer this in the space provided below.**
4. How does this compare to the descriptive analysis we did on the same data set? 
Think critically. What was possible using one method that was not possible using 
the other method? **Answer this in the space provided below.**

```{r, "Step 4.1"}
t_trans <- as(tdata, "transactions")
rules <- apriori(t_trans, parameter = list(support = 0.005, confidence = 0.5), appearance = list(rhs = c("Survived=Yes")))
plot(rules, method = "graph", control = list(type = "items"))

```

**Answer part 3 and 4 below.**

> Interestingly, the three most impactful rules regarding the data include the age of the survivor being a child, the sex of the survivor being a female, and the fact they survived in the first place. While the aRules graph is a decent visual adaptation of the data in the Titanic dataset, I feel the previous method of calculating percentages was a lot more informative, as it produced results that were a lot more clear and easy to understand than the info that the graph itself presents.


